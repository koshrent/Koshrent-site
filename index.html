<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rental Items | Koshrent</title>
  <meta name="description" content="Holiday flat-rate rentals and Pesach essentials in South Florida." />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900">

  <header class="bg-white border-b border-slate-200 sticky top-0 z-40">
    <div class="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between gap-3">
      <a class="font-extrabold text-lg" href="index.html">Koshrent</a>

      <nav class="hidden md:flex gap-6 text-sm font-semibold">
        <a class="hover:text-sky-700" href="rental-items.html">Shop</a>
        <a class="hover:text-sky-700" href="policies.html">Policies</a>
        <a class="hover:text-sky-700" href="contact.html">Contact</a>
      </nav>

      <button id="openCartBtn" class="rounded-xl bg-sky-700 text-white px-4 py-2 font-semibold hover:bg-sky-600">
        Cart (<span id="cartCount">0</span>)
      </button>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4 py-10">
    <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4">
      <div>
        <h1 class="text-3xl md:text-4xl font-extrabold">Holiday Rentals & Pesach Essentials</h1>
        <p class="mt-2 text-slate-700">
          Flat-rate pricing for the holiday season. Delivery: <b>Free over $200</b> • <b>$25 under $200</b>.
        </p>
        <p class="mt-2 text-xs text-slate-500">
          Note: Any “Quote” items aren’t included in totals until confirmed.
        </p>
      </div>

      <div class="bg-white border border-slate-200 rounded-2xl p-4 w-full lg:w-[520px]">
        <div class="text-sm font-bold text-slate-700">Request details (for checkout)</div>
        <div class="mt-3 grid grid-cols-2 gap-3">
          <div>
            <label class="text-xs text-slate-600">Start date</label>
            <input id="startDate" type="date" class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm" />
          </div>
          <div>
            <label class="text-xs text-slate-600">End date</label>
            <input id="endDate" type="date" class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm" />
          </div>
          <div class="col-span-2">
            <label class="text-xs text-slate-600">City / Area</label>
            <input id="city" placeholder="Fort Lauderdale, Hollywood, Miami, Sunny Isles..." class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm" />
          </div>
          <div class="col-span-2">
            <label class="text-xs text-slate-600">Delivery address</label>
            <input id="address" placeholder="Street address + unit code if needed" class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm" />
          </div>
        </div>
      </div>
    </div>

    <!-- Controls -->
    <div class="mt-6 grid md:grid-cols-3 gap-3">
      <div class="md:col-span-2">
        <input id="search" class="w-full rounded-xl border border-slate-300 px-4 py-3"
               placeholder="Search items (chairs, tables, fridge, fan, highchair, matzah...)" />
      </div>
      <div>
        <select id="categoryFilter" class="w-full rounded-xl border border-slate-300 px-4 py-3 bg-white">
          <option value="all">All categories</option>
        </select>
      </div>
    </div>

    <!-- Tabs -->
    <div class="mt-6 flex flex-wrap gap-2">
      <button id="tabAll" class="px-4 py-2 rounded-full bg-slate-900 text-white text-sm font-semibold">All</button>
      <button id="tabRentals" class="px-4 py-2 rounded-full bg-white border border-slate-200 text-sm font-semibold hover:border-slate-300">Rentals</button>
      <button id="tabSale" class="px-4 py-2 rounded-full bg-white border border-slate-200 text-sm font-semibold hover:border-slate-300">Pesach & Products</button>
    </div>

    <div id="status" class="mt-6 text-sm text-slate-600"></div>

    <!-- Items grid -->
    <div class="mt-4 grid md:grid-cols-2 lg:grid-cols-3 gap-4" id="itemsGrid"></div>
  </main>

  <!-- CART DRAWER -->
  <div id="cartOverlay" class="fixed inset-0 bg-black/40 hidden"></div>
  <aside id="cartDrawer" class="fixed top-0 right-0 h-full w-full max-w-md bg-white border-l border-slate-200 shadow-xl translate-x-full transition-transform">
    <div class="p-5 border-b border-slate-200 flex items-center justify-between">
      <div class="font-extrabold text-lg">Your Cart</div>
      <button id="closeCartBtn" class="rounded-lg border border-slate-300 px-3 py-2 text-sm">Close</button>
    </div>

    <div class="p-5 space-y-3 overflow-auto h-[calc(100%-260px)]" id="cartItems"></div>

    <div class="p-5 border-t border-slate-200">
      <div class="space-y-1 text-sm">
        <div class="flex items-center justify-between">
          <div class="text-slate-600">Priced items subtotal</div>
          <div class="font-semibold">$<span id="subtotal">0</span></div>
        </div>
        <div class="flex items-center justify-between">
          <div class="text-slate-600">Delivery</div>
          <div class="font-semibold">$<span id="delivery">0</span></div>
        </div>
        <div class="flex items-center justify-between text-base">
          <div class="font-extrabold">Estimated total</div>
          <div class="font-extrabold">$<span id="cartTotal">0</span></div>
        </div>
      </div>

      <div class="mt-3 text-xs text-slate-500">
        Free delivery over $200. Quote items not included until confirmed.
      </div>

      <button id="checkoutBtn" class="mt-4 w-full rounded-xl bg-emerald-600 text-white px-4 py-3 font-semibold hover:bg-emerald-500">
        Send Request (Checkout)
      </button>

      <button id="clearBtn" class="mt-2 w-full rounded-xl border border-slate-300 px-4 py-3 font-semibold hover:border-slate-400">
        Clear Cart
      </button>
    </div>
  </aside>

  <footer class="text-center text-xs text-slate-500 py-10">© Koshrent</footer>

  <script>
    // ====== SETTINGS ======
    // This CSV URL must be publicly accessible (no sign-in) for your website visitors.
    const SHEET_CSV_URL =
      "https://docs.google.com/spreadsheets/d/1HtMfgF99VA_tv-hpPIxgE8STlMkE4sCAYhS6YExrozE/export?format=csv&gid=0";

    const FREE_DELIVERY_OVER = 200;
    const DELIVERY_FEE_UNDER = 25;

    // ====== DATA ======
    let PRODUCTS = [];
    let activeTab = "all"; // all | rental | sale

    // ====== CSV PARSER ======
    function parseCSV(text) {
      const rows = [];
      let row = [], cell = "", inQuotes = false;

      for (let i = 0; i < text.length; i++) {
        const c = text[i];
        const next = text[i + 1];

        if (c === '"' && inQuotes && next === '"') { cell += '"'; i++; continue; }
        if (c === '"') { inQuotes = !inQuotes; continue; }

        if (c === "," && !inQuotes) { row.push(cell); cell = ""; continue; }
        if ((c === "\n" || c === "\r") && !inQuotes) {
          if (cell.length || row.length) row.push(cell);
          if (row.length) rows.push(row);
          row = []; cell = "";
          continue;
        }
        cell += c;
      }
      if (cell.length || row.length) { row.push(cell); rows.push(row); }
      return rows;
    }

    function money(n){ return (Math.round(n * 100) / 100).toFixed(0); }

    async function loadProductsFromSheet() {
      const status = document.getElementById("status");
      status.textContent = "Loading items from Google Sheet…";

      // Cache-bust so changes appear quickly:
      const url = SHEET_CSV_URL + (SHEET_CSV_URL.includes("?") ? "&" : "?") + "cb=" + Date.now();
      const res = await fetch(url, { cache: "no-store" });
      if (!res.ok) throw new Error("Could not load items from Google Sheet. Make sure the sheet is public.");

      const csv = await res.text();
      const rows = parseCSV(csv).filter(r => r.some(x => (x || "").trim() !== ""));
      const headers = rows[0].map(h => (h || "").trim().toLowerCase());
      const idx = (name) => headers.indexOf(name);

      const items = rows.slice(1).map(r => ({
        id: (r[idx("id")] || "").trim(),
        cat: (r[idx("category")] || "").trim(),
        name: (r[idx("name")] || "").trim(),
        price: Number((r[idx("price")] || "0").toString().replace(/[^0-9.]/g, "")) || 0,
        note: (r[idx("note")] || "").trim(),
        type: (r[idx("type")] || "rental").trim().toLowerCase(), // rental | sale
        active: ((r[idx("active")] || "TRUE").trim().toUpperCase() === "TRUE"),
      })).filter(x => x.id && x.name && x.cat && x.active);

      PRODUCTS = items;
      status.textContent = `Loaded ${PRODUCTS.length} active items.`;
    }

    // ====== CART ======
    const cartKey = "koshrent_cart_v2";
    function loadCart() { return JSON.parse(localStorage.getItem(cartKey) || "{}"); }
    function saveCart(cart) { localStorage.setItem(cartKey, JSON.stringify(cart)); renderCart(); renderCount(); }
    function addToCart(id) { const c = loadCart(); c[id] = (c[id] || 0) + 1; saveCart(c); openCart(); }
    function removeOne(id) { const c = loadCart(); if(!c[id]) return; c[id]--; if(c[id] <= 0) delete c[id]; saveCart(c); }
    function clearCart(){ localStorage.removeItem(cartKey); renderCart(); renderCount(); }

    // ====== UI RENDER ======
    const categoryLabels = {
      appliances: "Appliances",
      seating: "Tables & Chairs",
      baby: "Baby & Family",
      shabbos: "Shabbos / Yom Tov",
      pesach: "Pesach",
      extras: "Extras",
    };

    function buildCategoryFilter(){
      const sel = document.getElementById("categoryFilter");
      const cats = Array.from(new Set(PRODUCTS.map(p => p.cat))).sort();
      sel.innerHTML = `<option value="all">All categories</option>` +
        cats.map(c => `<option value="${c}">${categoryLabels[c] || c}</option>`).join("");
    }

    function productCard(p){
      const priceLabel = p.price > 0 ? `$${money(p.price)}` : "Quote";
      const badge = p.type === "sale"
        ? `<span class="text-xs font-bold px-2 py-1 rounded-full bg-amber-100 text-amber-900 border border-amber-200">For Sale</span>`
        : `<span class="text-xs font-bold px-2 py-1 rounded-full bg-sky-100 text-sky-900 border border-sky-200">Rental</span>`;

      return `
        <div class="rounded-2xl bg-white border border-slate-200 p-5">
          <div class="flex items-start justify-between gap-3">
            <div class="font-extrabold">${p.name}</div>
            ${badge}
          </div>
          <div class="mt-2 text-sm text-slate-600">${p.note || ""}</div>
          <div class="mt-4 flex items-center justify-between">
            <div class="text-lg font-extrabold">${priceLabel}</div>
            <button class="rounded-xl bg-sky-700 text-white px-4 py-2 font-semibold hover:bg-sky-600"
              onclick="addToCart('${p.id}')">Add</button>
          </div>
          <div class="mt-3 text-xs text-slate-500">${categoryLabels[p.cat] || p.cat}</div>
        </div>
      `;
    }

    function getFilteredProducts(){
      const q = (document.getElementById("search").value || "").trim().toLowerCase();
      const cat = document.getElementById("categoryFilter").value;

      return PRODUCTS.filter(p => {
        if (activeTab !== "all" && p.type !== activeTab) return false;
        if (cat !== "all" && p.cat !== cat) return false;
        if (q && !(p.name.toLowerCase().includes(q) || (p.note || "").toLowerCase().includes(q))) return false;
        return true;
      });
    }

    function renderProducts(){
      const grid = document.getElementById("itemsGrid");
      const list = getFilteredProducts();
      grid.innerHTML = list.length
        ? list.map(productCard).join("")
        : `<div class="text-slate-600 text-sm">No items match your filters.</div>`;
    }

    function renderCount(){
      const c = loadCart();
      const count = Object.values(c).reduce((a,b)=>a+b,0);
      document.getElementById("cartCount").textContent = count;
    }

    function renderCart(){
      const cart = loadCart();
      const wrap = document.getElementById("cartItems");
      wrap.innerHTML = "";

      let subtotal = 0;
      let hasQuote = false;

      const entries = Object.entries(cart);
      if(entries.length === 0){
        wrap.innerHTML = `<div class="text-slate-600 text-sm">Your cart is empty.</div>`;
      } else {
        entries.forEach(([id, qty]) => {
          const p = PRODUCTS.find(x => x.id === id);
          if(!p) return;

          if (p.price > 0) subtotal += p.price * qty;
          else hasQuote = true;

          wrap.innerHTML += `
            <div class="rounded-xl border border-slate-200 p-4">
              <div class="font-semibold">${p.name}</div>
              <div class="text-xs text-slate-500 mt-1">${categoryLabels[p.cat] || p.cat} • ${p.type === "sale" ? "For Sale" : "Rental"}</div>
              <div class="mt-3 flex items-center justify-between">
                <div class="text-sm">
                  Qty: <span class="font-bold">${qty}</span>
                  • ${p.price > 0 ? `$${money(p.price)} ea` : `Quote`}
                </div>
                <div class="flex items-center gap-2">
                  <button class="rounded-lg border border-slate-300 px-3 py-1" onclick="removeOne('${id}')">-</button>
                  <button class="rounded-lg border border-slate-300 px-3 py-1" onclick="addToCart('${id}')">+</button>
                </div>
              </div>
            </div>
          `;
        });

        if (hasQuote) {
          wrap.innerHTML += `<div class="text-xs text-slate-500">* Quote items are not included in totals until confirmed.</div>`;
        }
      }

      const delivery = (subtotal >= FREE_DELIVERY_OVER || subtotal === 0) ? 0 : DELIVERY_FEE_UNDER;
      const total = subtotal + delivery;

      document.getElementById("subtotal").textContent = money(subtotal);
      document.getElementById("delivery").textContent = money(delivery);
      document.getElementById("cartTotal").textContent = money(total);
    }

    // Drawer controls
    const overlay = document.getElementById("cartOverlay");
    const drawer = document.getElementById("cartDrawer");
    function openCart(){ overlay.classList.remove("hidden"); drawer.classList.remove("translate-x-full"); }
    function closeCart(){ overlay.classList.add("hidden"); drawer.classList.add("translate-x-full"); }

    document.getElementById("openCartBtn").addEventListener("click", openCart);
    document.getElementById("closeCartBtn").addEventListener("click", closeCart);
    overlay.addEventListener("click", closeCart);
    document.getElementById("clearBtn").addEventListener("click", clearCart);

    // Tabs
    function setTab(tab){
      activeTab = tab;
      const btnAll = document.getElementById("tabAll");
      const btnR = document.getElementById("tabRentals");
      const btnS = document.getElementById("tabSale");

      const on = "px-4 py-2 rounded-full bg-slate-900 text-white text-sm font-semibold";
      const off = "px-4 py-2 rounded-full bg-white border border-slate-200 text-sm font-semibold hover:border-slate-300";

      btnAll.className = (tab==="all") ? on : off;
      btnR.className = (tab==="rental") ? on : off;
      btnS.className = (tab==="sale") ? on : off;

      renderProducts();
    }
    document.getElementById("tabAll").addEventListener("click", () => setTab("all"));
    document.getElementById("tabRentals").addEventListener("click", () => setTab("rental"));
    document.getElementById("tabSale").addEventListener("click", () => setTab("sale"));

    // Filters
    document.getElementById("search").addEventListener("input", renderProducts);
    document.getElementById("categoryFilter").addEventListener("change", renderProducts);

    // Checkout -> builds a message, stores it, goes to contact page
    document.getElementById("checkoutBtn").addEventListener("click", () => {
      const cart = loadCart();

      const start = document.getElementById("startDate").value || "[start date]";
      const end = document.getElementById("endDate").value || "[end date]";
      const city = document.getElementById("city").value || "[city/area]";
      const address = document.getElementById("address").value || "[delivery address]";

      let lines = [];
      Object.entries(cart).forEach(([id, qty]) => {
        const p = PRODUCTS.find(x => x.id === id);
        if(!p) return;
        const priceLabel = p.price > 0 ? `$${money(p.price)} ea` : "Quote";
        lines.push(`- ${p.name} (qty ${qty}) — ${priceLabel}`);
      });

      const subtotal = Number(document.getElementById("subtotal").textContent || "0");
      const delivery = Number(document.getElementById("delivery").textContent || "0");
      const total = Number(document.getElementById("cartTotal").textContent || "0");

      const msg =
`Hi Koshrent! I'd like to place a request.

Dates: ${start} to ${end}
City/Area: ${city}
Delivery address: ${address}

Items:
${lines.length ? lines.join("\n") : "- (no items)"}

Priced subtotal: $${money(subtotal)}
Delivery: $${money(delivery)} (Free over $${FREE_DELIVERY_OVER}, otherwise $${DELIVERY_FEE_UNDER})
Estimated total: $${money(total)}

Notes (Shabbos/Pesach needs, pickup time, etc.):
`;

      localStorage.setItem("koshrent_checkout_message", msg);
      window.location.href = "contact.html#quote";
    });

    // Init
    (async function init(){
      try{
        await loadProductsFromSheet();
        buildCategoryFilter();
        renderProducts();
        renderCart();
        renderCount();
      } catch(e){
        console.error(e);
        document.getElementById("status").innerHTML =
          `<div class="rounded-xl border border-red-200 bg-red-50 p-4 text-red-800">
             <b>Couldn’t load your Google Sheet.</b><br/>
             Make sure your sheet is shared as <i>Anyone with the link (Viewer)</i>, then refresh.
           </div>`;
      }
    })();

    // expose for inline onclick
    window.addToCart = addToCart;
    window.removeOne = removeOne;
  </script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Contact | Koshrent</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900">
  <header class="bg-white border-b border-slate-200">
    <div class="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between">
      <a class="font-extrabold text-lg" href="index.html">Koshrent</a>
      <nav class="flex gap-5 text-sm font-semibold">
        <a class="hover:text-sky-700" href="rental-items.html">Shop</a>
        <a class="hover:text-sky-700" href="policies.html">Policies</a>
        <a class="hover:text-sky-700" href="contact.html">Contact</a>
      </nav>
    </div>
  </header>

  <main class="mx-auto max-w-3xl px-4 py-10">
    <h1 class="text-3xl font-extrabold">Contact</h1>
    <p class="mt-2 text-slate-700">Send us your request by WhatsApp or email.</p>

    <div class="mt-6 grid gap-4">
      <div class="rounded-2xl bg-white border border-slate-200 p-6">
        <div class="font-bold">Email</div>
        <div class="text-slate-700 mt-1">info@koshrent.com</div>
      </div>

      <div id="whatsapp" class="rounded-2xl bg-white border border-slate-200 p-6">
        <div class="font-bold">WhatsApp</div>
        <div class="text-slate-700 mt-1" id="waDisplay">+1 (XXX) XXX-XXXX</div>
        <div class="mt-3 text-xs text-slate-500">
          Replace the number in this file when you’re ready.
        </div>
      </div>

      <div id="quote" class="rounded-2xl bg-white border border-slate-200 p-6">
        <div class="font-extrabold text-xl">Your message</div>
        <p class="mt-2 text-slate-700 text-sm">This was generated from your cart. You can edit before sending.</p>

        <textarea id="msg" class="mt-3 w-full min-h-[220px] rounded-xl border border-slate-300 p-4 text-sm"></textarea>

        <div class="mt-4 flex flex-wrap gap-2">
          <button id="copyBtn" class="rounded-xl bg-slate-900 text-white px-4 py-3 font-semibold hover:bg-slate-800">
            Copy Message
          </button>
          <a id="waBtn" class="rounded-xl bg-emerald-600 text-white px-4 py-3 font-semibold hover:bg-emerald-500" href="#" target="_blank" rel="noopener">
            Open WhatsApp
          </a>
        </div>

        <div class="mt-3 text-xs text-slate-500">
          If WhatsApp link doesn’t work on desktop, paste the copied message into WhatsApp Web.
        </div>
      </div>
    </div>
  </main>

  <footer class="text-center text-xs text-slate-500 py-10">© Koshrent</footer>

  <script>
    // TODO: Set your real WhatsApp number here (digits only, with country code)
    // Example: 17545551234
    const WA_NUMBER = "1XXXXXXXXXX";

    const msg = localStorage.getItem("koshrent_checkout_message") ||
`Hi Koshrent! I'd like to request a quote.

Dates:
City/Area:
Delivery address:

Items:
- 

Notes:
`;

    document.getElementById("msg").value = msg;

    // Display number nicely if you fill WA_NUMBER later
    if(WA_NUMBER && !WA_NUMBER.includes("X")){
      document.getElementById("waDisplay").textContent = "+" + WA_NUMBER;
    }

    document.getElementById("copyBtn").addEventListener("click", async () => {
      try{
        await navigator.clipboard.writeText(document.getElementById("msg").value);
        alert("Copied!");
      } catch(e){
        alert("Could not copy automatically. Select the text and copy manually.");
      }
    });

    // WhatsApp deep link
    const encoded = encodeURIComponent(document.getElementById("msg").value);
    const waLink = (WA_NUMBER && !WA_NUMBER.includes("X"))
      ? `https://wa.me/${WA_NUMBER}?text=${encoded}`
      : `https://web.whatsapp.com/`;

    document.getElementById("waBtn").href = waLink;
  </script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Policies | Koshrent</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900">
  <header class="bg-white border-b border-slate-200">
    <div class="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between">
      <a class="font-extrabold text-lg" href="index.html">Koshrent</a>
      <nav class="flex gap-5 text-sm font-semibold">
        <a class="hover:text-sky-700" href="rental-items.html">Shop</a>
        <a class="hover:text-sky-700" href="policies.html">Policies</a>
        <a class="hover:text-sky-700" href="contact.html">Contact</a>
      </nav>
    </div>
  </header>

  <main class="mx-auto max-w-3xl px-4 py-10">
    <h1 class="text-3xl font-extrabold">Policies</h1>

    <div class="mt-6 space-y-4">
      <div class="rounded-2xl bg-white border border-slate-200 p-6">
        <div class="font-extrabold">Delivery</div>
        <ul class="mt-2 list-disc pl-5 text-slate-700 space-y-1">
          <li>Free delivery for orders over <b>$200</b></li>
          <li><b>$25</b> delivery fee for orders under $200</li>
          <li>Delivery windows and setup depend on location and season</li>
        </ul>
      </div>

      <div class="rounded-2xl bg-white border border-slate-200 p-6">
        <div class="font-extrabold">Holiday Flat Rates</div>
        <p class="mt-2 text-slate-700">
          Item pricing shown is flat-rate for the holiday season unless noted as “Quote”.
        </p>
      </div>

      <div class="rounded-2xl bg-white border border-slate-200 p-6">
        <div class="font-extrabold">Pesach & Wine</div>
        <p class="mt-2 text-slate-700">
          Pesach items and wine availability can vary. Please confirm brands, certifications, and availability with us.
        </p>
      </div>
    </div>
  </main>

  <footer class="text-center text-xs text-slate-500 py-10">© Koshrent</footer>
</body>
</html>


